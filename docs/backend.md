# üîß Backend Documentation

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é backend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ BTEU Schedule.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [API Endpoints](#api-endpoints)
- [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
- [–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è](#–∑–∞–≥—Ä—É–∑–∫–∞-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è)
- [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π-–∑–∞–ø—É—Å–∫)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd backend
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL 12+ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```sql
CREATE DATABASE bteu_schedule;
CREATE USER your_username WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE bteu_schedule TO your_username;
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/.env` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–º. —Ä–∞–∑–¥–µ–ª [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)).

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
python server.py
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞:

```bash
# Windows
start_server.bat

# Linux/Mac
./start_server.sh
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:5000/v1/health`

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å: `{"status": "ok"}`

## üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏, –≥—Ä—É–ø–ø–∞—Ö, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö –∏ –¥—Ä—É–≥–æ–π —É—á–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

### –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏–ª–∏ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã.

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `.env`:

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=bteu_schedule
DB_USER=your_username
DB_PASSWORD=your_password
```

## üì° API Endpoints

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

- `GET /v1/faculties` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–æ–≤
- `GET /v1/faculties/<int:faculty_id>/departments` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞—Ñ–µ–¥—Ä —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
- `GET /v1/departments` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ñ–µ–¥—Ä
- `GET /v1/groups` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä—É–ø–ø
- `GET /v1/groups/<code>` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ
- `GET /v1/schedule/group/<code>/week` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é
- `GET /v1/schedule/group/<code>/day/<int:day>` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å (0-6, –≥–¥–µ 0 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)

### –≠–∫–∑–∞–º–µ–Ω—ã –∏ —Ç–µ—Å—Ç—ã

- `GET /v1/exams/group/<code>` ‚Äî —Å–ø–∏—Å–æ–∫ —ç–∫–∑–∞–º–µ–Ω–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø—ã
- `GET /v1/tests/group/<code>` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤/–∑–∞—á–µ—Ç–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø—ã

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

- `GET /v1/analytics/group/<code>` ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã

### AI –∏ –ø–æ–∏—Å–∫

- `POST /v1/ai/chat` ‚Äî AI —á–∞—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
  ```json
  {
    "message": "–ö–æ–≥–¥–∞ —Å–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞?",
    "group_code": "–ü–û-31"
  }
  ```
- `GET /v1/ai/status` ‚Äî —Å—Ç–∞—Ç—É—Å AI —Å–µ—Ä–≤–∏—Å–∞
- `POST /v1/ai/find-next-lesson` ‚Äî –Ω–∞–π—Ç–∏ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ
- `GET /v1/search` ‚Äî –ø–æ–∏—Å–∫ –ø–æ –≥—Ä—É–ø–ø–∞–º, –ø—Ä–µ–¥–º–µ—Ç–∞–º, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- `GET /v1/bell-schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints

- `POST /v1/admin/parse-excel` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ Excel —Ñ–∞–π–ª–∞ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
  ```
  Form data:
  - file: Excel —Ñ–∞–π–ª
  - group_code: –ö–æ–¥ –≥—Ä—É–ø–ø—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ```
- `POST /v1/admin/batch-parse` ‚Äî –º–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π

### –°–ª—É–∂–µ–±–Ω—ã–µ endpoints

- `GET /` ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `GET /v1/` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ API
- `GET /v1/health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:5000/v1/`

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/.env` –≤ –∫–æ—Ä–Ω–µ –ø–∞–ø–∫–∏ `backend/`:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_HOST=localhost
DB_PORT=5432
DB_NAME=bteu_schedule
DB_USER=your_username
DB_PASSWORD=your_password

# AI —Å–µ—Ä–≤–∏—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=your_openai_key
GEMINI_API_KEY=your_gemini_key
OLLAMA_BASE_URL=http://localhost:11434

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
FLASK_ENV=development
FLASK_DEBUG=True
PORT=5000
HOST=0.0.0.0
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

- **DB_HOST** ‚Äî –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: localhost)
- **DB_PORT** ‚Äî –ø–æ—Ä—Ç PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5432)
- **DB_NAME** ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **DB_USER** ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **DB_PASSWORD** ‚Äî –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- **OPENAI_API_KEY** ‚Äî API –∫–ª—é—á OpenAI (–¥–ª—è AI —á–∞—Ç–∞)
- **GEMINI_API_KEY** ‚Äî API –∫–ª—é—á Google Gemini (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ OpenAI)
- **OLLAMA_BASE_URL** ‚Äî URL –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ Ollama

- **FLASK_ENV** ‚Äî –æ–∫—Ä—É–∂–µ–Ω–∏–µ Flask (development/production)
- **FLASK_DEBUG** ‚Äî —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (True/False)
- **PORT** ‚Äî –ø–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5000)
- **HOST** ‚Äî —Ö–æ—Å—Ç –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.0.0.0)

## üìù –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –ß–µ—Ä–µ–∑ API

–ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:

```bash
curl -X POST http://localhost:5000/v1/admin/parse-excel \
  -F "file=@schedule.xlsx" \
  -F "group_code=–ü–û-31"
```

–ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:

```bash
curl -X POST http://localhost:5000/v1/admin/batch-parse \
  -F "files=@schedule1.xlsx" \
  -F "files=@schedule2.xlsx"
```

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:

```bash
python backend/sync_schedule.py
```

–ó–∞–≥—Ä—É–∑–∫–∞ —Å FTP —Å–µ—Ä–≤–µ—Ä–∞:

```bash
python backend/download_schedule.py
```

–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å FTP –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:

```bash
python backend/sync_from_ftp.py
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

### Windows

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ backend –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã:

```powershell
cd backend
.\setup_autostart.ps1
```

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏:

```powershell
.\remove_autostart.bat
```

### Linux/Mac

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd, supervisor –∏–ª–∏ screen/tmux –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

–ü—Ä–∏–º–µ—Ä systemd service (`/etc/systemd/system/bteu-schedule.service`):

```ini
[Unit]
Description=BTEU Schedule Backend
After=network.target postgresql.service

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/BTEU_Schedule/backend
Environment="PATH=/usr/bin:/usr/local/bin"
ExecStart=/usr/bin/python3 server.py
Restart=always

[Install]
WantedBy=multi-user.target
```

–ó–∞—Ç–µ–º:

```bash
sudo systemctl enable bteu-schedule
sudo systemctl start bteu-schedule
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ server.py              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª Flask —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ db_connection.py       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ excel_parser.py        # –ü–∞—Ä—Å–µ—Ä Excel —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ excel_parser_v2.py     # –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–∞—Ä—Å–µ—Ä–∞
‚îú‚îÄ‚îÄ exam_parser.py         # –ü–∞—Ä—Å–µ—Ä —ç–∫–∑–∞–º–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ transport_request_parser.py  # –ü–∞—Ä—Å–µ—Ä –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–µ—Ä–µ–≤–æ–∑–∫—É
‚îú‚îÄ‚îÄ ai_service.py          # –°–µ—Ä–≤–∏—Å AI —á–∞—Ç–∞
‚îú‚îÄ‚îÄ schedule_analytics.py  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- Postman
- curl
- httpie
- Python requests

–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:

```python
import requests

response = requests.get('http://localhost:5000/v1/faculties')
print(response.json())
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- Flask –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://flask.palletsprojects.com/
- PostgreSQL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://www.postgresql.org/docs/
- SQLAlchemy (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è): https://www.sqlalchemy.org/
